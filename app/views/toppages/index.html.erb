<h1>toppage</h1>

<% if logged_in? %>
  <%= link_to "ユーザー情報の変更", edit_user_path(current_user) %>
  <%= link_to 'ログアウト', logout_path, method: :delete %>
  <%= link_to "お問い合わせ", inquiry_input_path %>
<% else %>
  <%= link_to '新規登録', signup_path %>
  <%= link_to 'ログイン', login_path %>
<% end %>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDh_J3NoIMD5Kv4oB7HX_XXuqRhJFtXNFA"></script>
<script>
  var map;
  var marker = [];
  var infoWindow = [];
  var currentInfoWindow = null;
  var markerData = [
    {
      name: 'イベントA',
      place: '東京駅',
      lat: 35.681236,
      lng: 139.767125,
    }, {
      name: 'イベントB',
      place: '東京駅',
      lat: 35.6951212,
      lng: 139.76610649999998
    }, {
      name: 'イベントC',
      place: '滋賀県彦根市',
      lat: 35.69496,
      lng: 139.76746000000003
    }, {
      name: 'イベントD',
      place: '岐阜県岐阜市',
      lat: 35.6993529,
      lng: 139.76526949999993
    }, {
      name: 'イベントE',
      place: '駅',
      lat: 35.695932,
      lng: 139.75762699999996
    }, {
      name: 'イベントF',
      place: '駅',
      lat: 35.696932,
      lng: 139.76543200000003
   }
  ];

  function initMap() {
    // マップの緯度経度のデータ作成
    var mapLatLng = new google.maps.LatLng(35.681236,139.767125);

    // 'div#map'に地図を埋め込む
    map = new google.maps.Map(document.getElementById('map'), {
      center: mapLatLng,
      zoom: 10
    });

    // マーカー毎の処理
    for (var i = 0; i < markerData.length; i++) {
      // マーカーの緯度経度のデータ作成
      markerLatLng = new google.maps.LatLng({lat: markerData[i]['lat'], lng: markerData[i]['lng']});

      // マーカーの追加
      marker[i] = new google.maps.Marker({
        map: map,
        position: markerLatLng
      });

      // 吹き出しの追加
      infoWindow[i] = new google.maps.InfoWindow({
        content: '<div class="marker_name">' + markerData[i]['name'] + '</div>'
                  + '<div class="marker_place">' + markerData[i]['place'] + '</div>'
                  + '<%= link_to 'イベント詳細はこちら', root_path %>'
      });

      markerEvent(i);
    }
  }

  // マーカーをクリックした時に1件のみ吹き出しを表示する
  function markerEvent(i) {
    marker[i].addListener('click', function() {
      if (currentInfoWindow) {
        currentInfoWindow.close();
      }

      infoWindow[i].open(map, marker[i]);
      currentInfoWindow = infoWindow[i];
    });
  }

  window.onload = initMap();
</script>
