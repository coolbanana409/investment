<div class="ui center aligned grid">
  <img id="toppage-image" src="/img/events/event1.jpg">
</div>

<div id="what-is-this-application-in-japanese">
  <div class="ui center aligned grid">
    <div class="fourteen wide column">
      <h2>(アプリ名)とは</h2>
    </div>
  </div>
</div>
<div class="ui centered grid">
  <div id="explanation-of-application" class="left aligned fourteen wide column">
    (アプリ名)とはあなたの身の回りで開催されているイベントを知るためのアプリです。
    新規登録、ログインをしていただきますと、各地で開かれているイベントの詳細について、ジャンルごとに検索できたり、
    もし、あなたがイベント主催者ならば、自分のイベントをこのサイトで紹介することができます。
  </div>
</div>

<div class="ui divider" id="divider-above-characteristic"></div>

<div class="characteristics-of-application">
  <div class="ui center aligned grid">
    <div class="fourteen wide column">
      <h2>このアプリの特徴</h2>
    </div>
  </div>
</div>
<div id="major-characteristics">
  <div class="one-of-the-characteristics">
    <div class="ui center aligned grid">
      <div class="fourteen wide column">
        <div class="ui center aligned grid">
          <div class="center aligned six wide column">
            <i class="bullhorn huge icon"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="ui center aligned grid">
      <div class="left aligned twelve wide column">
        もしあなたがイベントを主催しているのであれば、このアプリでそのイベントを拡散することで、
        イベントの集客数を増やすことができます。
      </div>
    </div>
  </div>
  <div class="one-of-the-characteristics">
    <div class="ui center aligned grid">
      <div class="fourteen wide column">
        <div class="ui center aligned grid">
          <div class="center aligned six wide column">
            <i class="search huge icon"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="ui center aligned grid">
      <div class="left aligned twelve wide column">
        自分の周りで開催されているイベントを発見することができます。
        時系列による分類や、人気順などによる並び替えにより、あなたの探したいイベント簡単に探すことができます。
      </div>
    </div>
  </div>
  <div class="one-of-the-characteristics">
    <div class="ui center aligned grid">
      <div class="fourteen wide column">
        <div class="ui center aligned grid">
          <div class="center aligned six wide column">
            <i class="tags huge icon"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="ui center aligned grid">
      <div class="left aligned twelve wide column">
        自分の好みのイベントをブックマークしておけば、いつでも気軽に、それらのイベントの詳細情報を知ることができます。
        また、自分の興味のある複数のイベントの情報を簡単に管理することができます。
      </div>
    </div>
  </div>
</div>

<div class="ui divider" id="divider-above-use-for-trial"></div>

<div class="use-for-trial">
  <div class="ui center aligned grid">
    <div class="fourteen wide column">
      <h2>試しに使ってみよう</h2>
    </div>
  </div>
</div>
<div id="frame-of-lets-search">
  <div class="ui center aligned grid">
    <div id="lets-search" class="left aligned fourteen wide column">
      試しにあなたの身の回りのイベントを探してみましょう。
      まずは、住所を検索するか、位置情報を送信してみましょう。
    </div>
  </div>
</div>

<div id="map"></div>
<div class="ui center aligned grid" id="search-address">
  <div class="fourteen wide columm">
    <div class="item">
      <div class="ui icon input">
        <input type="text" name="address" placeholder="例：東京都渋谷区">
        <i class="search link icon"></i>
        <input type="button" id="search" value="検索">
      </div>
    </div>
  </div>
</div>
<div id="frame-of-map-explanation">
  <div class="ui center aligned grid">
    <div id="map-explanation" class="left aligned fourteen wide column">
      地図上の赤色のピンが立っている場所が今後イベントが行われる場所であり、
      ピンをタッチするとそのイベントの主要な情報を確認することができます。
      新規登録、またはログインをして、あなたの身の回りで今後行われるイベントの詳細を確認してみましょう。
    </div>
  </div>
</div>

<script>
  var map;
  var marker = [];
  var infoWindow = [];
  var currentInfoWindow = null;
  var geocoder = new google.maps.Geocoder();
  var markerDataArray = [];

  function initMap() {
    <% @events.each do |event| %>
      geocoder.geocode(
        {
          'address': '<%= event.place %>',
          'region': 'jp'
        },
          function (results, status) {
            if (status === 'OK' && results[0]){
              var mapLatLng = new google.maps.LatLng(35.681236,139.767125);
              var pos = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
              var markerLatLng;
              var markerData = [
                {
                  name: '<%= event.name %>',
                  place: '<%= event.place %>',
                  lat: pos.lat(),
                  lng: pos.lng(),
                }
              ];

              map = new google.maps.Map(document.getElementById('map'), {
                center: mapLatLng,
                zoom: 10,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false,
              });

              // markerDataの数を数えるため
              markerDataArray.push(markerData);

              for (var i = 0; i < markerDataArray.length; i++) {
                var markerLatLng = new google.maps.LatLng({lat: markerDataArray[i][0].lat, lng: markerDataArray[i][0].lng});

                marker[i] = new google.maps.Marker({
                  map: map,
                  position: markerLatLng
                });

                infoWindow[i] = new google.maps.InfoWindow({
                  content: '<div class="marker_name">' + markerDataArray[i][0].name + '</div>'
                            + '<div class="marker_place">' + markerDataArray[i][0].place + '</div>'
                });

                addInfowindowToMarker(i);
              }

            }else{
              alert('失敗しました。理由: ' + status);
            }
          }
      );
    <% end %>
  }

  function addInfowindowToMarker(i) {
    marker[i].addListener('click', function() {
      if (currentInfoWindow) {
        currentInfoWindow.close();
      }

      infoWindow[i].open(map, marker[i]);
      currentInfoWindow = infoWindow[i];
    });
  }

  $('#search').click(function () {
    var address = $('[name = address]').val();

    geocoder.geocode(
      {
        'address': address,
        'region': 'jp'
      },
      function (results, status) {
        if (status === 'OK' && results[0]) {
          map.setCenter(results[0].geometry.location);
        } else {
          alert('住所検索に失敗しました。住所が正しいか確認してください');
        }
      }
    );
  });

  window.onload = initMap();
</script>
